{% extends 'gestion/base.html' %}
{% load static %}

{% block title %}Crear Producto - Gesti√≥n Diet√©tica{% endblock %}

{% block extra_head %}
<!-- Wizard Productos Styles -->
<link rel="stylesheet" href="{% static 'css/lino-wizard-ventas.css' %}?v=20241030">
<style>
body {
    background-color: #fafaf9 !important;
}

.container-fluid {
    padding: 2rem 1rem;
}

/* Loading spinner for buttons */
.lino-loading-spinner {
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top: 2px solid white;
    border-radius: 50%;
    animation: lino-spin 1s linear infinite;
}

@keyframes lino-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
{% endblock %}

{% block header %}
<div class="page-header d-flex justify-content-between align-items-center">
    <div>
        <h1 class="h3 mb-1"><i class="bi bi-box-seam me-2"></i>Nuevo Producto Diet√©tico</h1>
        <p class="text-muted mb-0">Complete los pasos para agregar el producto al inventario</p>
    </div>
</div>
{% endblock %}

{% block content %}

<form method="post" enctype="multipart/form-data" id="productoForm">
    {% csrf_token %}

<div class="lino-wizard lino-wizard-productos">
    <!-- ===== INDICADOR DE PROGRESO ===== -->
    <div class="lino-wizard-progress">
        <div class="lino-wizard-steps">
            <div class="lino-wizard-step lino-wizard-step--active" data-step="1">
                <div class="lino-wizard-step-circle">1</div>
                <div class="lino-wizard-step-label">Informaci√≥n</div>
            </div>
            <div class="lino-wizard-step" data-step="2">
                <div class="lino-wizard-step-circle">2</div>
                <div class="lino-wizard-step-label">Nutricional</div>
            </div>
            <div class="lino-wizard-step" data-step="3">
                <div class="lino-wizard-step-circle">3</div>
                <div class="lino-wizard-step-label">Confirmar</div>
            </div>
        </div>
    </div>

    <!-- ===== CONTENIDO DEL WIZARD ===== -->
    <div class="lino-wizard-content">
        
        <!-- ===== PASO 1: INFORMACI√ìN B√ÅSICA ===== -->
        <div class="lino-wizard-step-content active" data-step="1">
            <h2 class="lino-wizard-step-title">
                <span class="step-emoji">üì¶</span>
                Informaci√≥n B√°sica del Producto
            </h2>
            <p class="lino-wizard-step-subtitle">
                Complete los datos esenciales del producto diet√©tico
            </p>
            
            <div class="row g-4">
                <div class="col-md-8">
                    <div class="lino-form-group">
                        <label class="lino-label lino-label-required">Nombre del Producto</label>
                        <input type="text" 
                               name="nombre" 
                               id="nombreInput"
                               class="lino-input"
                               placeholder="Ej: Man√≠ sin sal 500g"
                               required
                               autofocus>
                        <small class="lino-helper-text">
                            <i class="bi bi-info-circle"></i>
                            Incluye el tama√±o o peso si corresponde
                        </small>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="lino-form-group">
                        <label class="lino-label lino-label-required">Categor√≠a</label>
                        <select name="categoria" id="categoriaInput" class="lino-select" required>
                            <option value="">Seleccionar...</option>
                            <option value="cereales">üåæ Cereales y Granos</option>
                            <option value="proteinas">ü•© Prote√≠nas</option>
                            <option value="lacteos">ü•õ L√°cteos sin Lactosa</option>
                            <option value="frutas">üçé Frutas y Vegetales</option>
                            <option value="snacks">ü•ú Snacks Saludables</option>
                            <option value="bebidas">üßÉ Bebidas Funcionales</option>
                            <option value="suplementos">üíä Suplementos</option>
                            <option value="otros">üì¶ Otros</option>
                        </select>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="lino-form-group">
                        <label class="lino-label lino-label-required">Precio de Venta</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" 
                                   name="precio" 
                                   id="precioInput"
                                   class="lino-input"
                                   placeholder="0.00"
                                   step="0.01"
                                   min="0"
                                   required>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="lino-form-group">
                        <label class="lino-label lino-label-required">Stock Inicial</label>
                        <input type="number" 
                               name="stock" 
                               id="stockInput"
                               class="lino-input"
                               placeholder="0"
                               min="0"
                               required>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="lino-form-group">
                        <label class="lino-label">C√≥digo de Barras</label>
                        <input type="text" 
                               name="codigo_barras" 
                               id="codigoInput"
                               class="lino-input"
                               placeholder="Opcional">
                    </div>
                </div>

                <div class="col-12">
                    <div class="lino-form-group">
                        <label class="lino-label">Descripci√≥n</label>
                        <textarea name="descripcion" 
                                  id="descripcionInput"
                                  class="lino-input"
                                  rows="3"
                                  placeholder="Describe las caracter√≠sticas, beneficios y usos del producto..."></textarea>
                    </div>
                </div>
            </div>

            <div class="lino-wizard-actions">
                <a href="{% url 'gestion:lista_productos' %}" class="lino-btn lino-btn-ghost">
                    <i class="bi bi-x-circle"></i> Cancelar
                </a>
                <button type="button" class="lino-btn lino-btn-primary" onclick="nextStep(2)">
                    Siguiente <i class="bi bi-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- ===== PASO 2: INFORMACI√ìN NUTRICIONAL ===== -->
        <div class="lino-wizard-step-content" data-step="2">
            <h2 class="lino-wizard-step-title">
                <span class="step-emoji">üçΩÔ∏è</span>
                Informaci√≥n Nutricional
            </h2>
            <p class="lino-wizard-step-subtitle">
                Complete los valores nutricionales por cada 100g del producto
            </p>

            <div class="row g-4">
                <div class="col-md-4">
                    <div class="lino-form-group">
                        <label class="lino-label">‚ö° Calor√≠as</label>
                        <div class="input-group">
                            <input type="number" 
                                   name="calorias" 
                                   id="caloriasInput"
                                   class="lino-input"
                                   placeholder="0"
                                   min="0">
                            <span class="input-group-text">kcal</span>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="lino-form-group">
                        <label class="lino-label">ü•© Prote√≠nas</label>
                        <div class="input-group">
                            <input type="number" 
                                   name="proteinas" 
                                   id="proteinasInput"
                                   class="lino-input"
                                   placeholder="0.0"
                                   step="0.1"
                                   min="0">
                            <span class="input-group-text">g</span>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="lino-form-group">
                        <label class="lino-label">üåæ Carbohidratos</label>
                        <div class="input-group">
                            <input type="number" 
                                   name="carbohidratos" 
                                   id="carbosInput"
                                   class="lino-input"
                                   placeholder="0.0"
                                   step="0.1"
                                   min="0">
                            <span class="input-group-text">g</span>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="lino-form-group">
                        <label class="lino-label">ü•ë Grasas Totales</label>
                        <div class="input-group">
                            <input type="number" 
                                   name="grasas" 
                                   id="grasasInput"
                                   class="lino-input"
                                   placeholder="0.0"
                                   step="0.1"
                                   min="0">
                            <span class="input-group-text">g</span>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="lino-form-group">
                        <label class="lino-label">üåø Fibra Diet√©tica</label>
                        <div class="input-group">
                            <input type="number" 
                                   name="fibra" 
                                   id="fibraInput"
                                   class="lino-input"
                                   placeholder="0.0"
                                   step="0.1"
                                   min="0">
                            <span class="input-group-text">g</span>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="lino-form-group">
                        <label class="lino-label">üßÇ Sodio</label>
                        <div class="input-group">
                            <input type="number" 
                                   name="sodio" 
                                   id="sodioInput"
                                   class="lino-input"
                                   placeholder="0"
                                   min="0">
                            <span class="input-group-text">mg</span>
                        </div>
                    </div>
                </div>

                <div class="col-12">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <small>Los valores nutricionales son <strong>opcionales</strong>. Si no los conoces, puedes dejarlos en blanco y completarlos m√°s tarde.</small>
                    </div>
                </div>
            </div>

            <div class="lino-wizard-actions">
                <button type="button" class="lino-btn lino-btn-ghost" onclick="prevStep(1)">
                    <i class="bi bi-arrow-left"></i> Atr√°s
                </button>
                <button type="button" class="lino-btn lino-btn-primary" onclick="nextStep(3)">
                    Siguiente <i class="bi bi-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- ===== PASO 3: CARACTER√çSTICAS Y CONFIRMACI√ìN ===== -->
        <div class="lino-wizard-step-content" data-step="3">
            <h2 class="lino-wizard-step-title">
                <span class="step-emoji">‚úÖ</span>
                Caracter√≠sticas y Confirmaci√≥n
            </h2>
            <p class="lino-wizard-step-subtitle">
                Marque las caracter√≠sticas especiales y revise el resumen antes de guardar
            </p>

            <!-- Caracter√≠sticas Especiales -->
            <div class="mb-4">
                <h6 class="mb-3"><i class="bi bi-stars me-2 text-warning"></i>Caracter√≠sticas Diet√©ticas</h6>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="form-check">
                            <input type="checkbox" name="sin_gluten" id="sinGlutenCheck" class="form-check-input">
                            <label for="sinGlutenCheck" class="form-check-label">üåæ Sin Gluten</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check">
                            <input type="checkbox" name="sin_lactosa" id="sinLactosaCheck" class="form-check-input">
                            <label for="sinLactosaCheck" class="form-check-label">ü•õ Sin Lactosa</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check">
                            <input type="checkbox" name="vegano" id="veganoCheck" class="form-check-input">
                            <label for="veganoCheck" class="form-check-label">üå± Vegano</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check">
                            <input type="checkbox" name="organico" id="organicoCheck" class="form-check-input">
                            <label for="organicoCheck" class="form-check-label">üçÉ Org√°nico</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check">
                            <input type="checkbox" name="keto" id="ketoCheck" class="form-check-input">
                            <label for="ketoCheck" class="form-check-label">ü•ë Keto Friendly</label>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check">
                            <input type="checkbox" name="bajo_sodio" id="bajoSodioCheck" class="form-check-input">
                            <label for="bajoSodioCheck" class="form-check-label">üßÇ Bajo en Sodio</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resumen del Producto -->
            <div class="lino-summary-card">
                <div class="lino-summary-header">
                    <i class="bi bi-clipboard-check"></i>
                    <span>Resumen del Producto</span>
                </div>
                
                <div class="lino-summary-row">
                    <span class="lino-summary-label">Producto:</span>
                    <strong class="lino-summary-value" id="summaryNombre">-</strong>
                </div>
                
                <div class="lino-summary-row">
                    <span class="lino-summary-label">Categor√≠a:</span>
                    <strong class="lino-summary-value" id="summaryCategoria">-</strong>
                </div>
                
                <div class="lino-summary-row">
                    <span class="lino-summary-label">Stock Inicial:</span>
                    <strong class="lino-summary-value">
                        <span id="summaryStock">0</span> unidades
                    </strong>
                </div>
                
                <div class="lino-summary-row">
                    <span class="lino-summary-label">Precio de Venta:</span>
                    <span class="lino-summary-total" id="summaryPrecio">$0.00</span>
                </div>
            </div>

            <!-- Info Nutricional (si se complet√≥) -->
            <div class="lino-detail-card mt-3" id="infoNutricionalCard" style="display:none;">
                <div class="lino-detail-header">
                    <i class="bi bi-activity"></i>
                    <h3 class="lino-detail-header-title">Informaci√≥n Nutricional (por 100g)</h3>
                </div>
                
                <div class="p-3">
                    <div class="row g-3 text-center">
                        <div class="col-4">
                            <div class="small text-muted">Calor√≠as</div>
                            <div class="fw-bold fs-5" id="summaryCalorias">-</div>
                        </div>
                        <div class="col-4">
                            <div class="small text-muted">Prote√≠nas</div>
                            <div class="fw-bold fs-5" id="summaryProteinas">-</div>
                        </div>
                        <div class="col-4">
                            <div class="small text-muted">Carbohidratos</div>
                            <div class="fw-bold fs-5" id="summaryCarbs">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lino-wizard-actions">
                <button type="button" class="lino-btn lino-btn-ghost" onclick="prevStep(2)">
                    <i class="bi bi-arrow-left"></i> Atr√°s
                </button>
                <button type="submit" class="lino-btn lino-btn-primary lino-btn-lg" id="btnSubmit">
                    <i class="bi bi-check-circle"></i> Crear Producto
                </button>
            </div>
        </div>
    </div>
</div>
</form>

<div class="container-fluid" style="display:none;">
    <div class="row">
        <!-- FORMULARIO -->
        <div class="col-lg-8">
            <div class="lino-form-container">
                <!-- HEADER -->
                <div class="lino-form-header">
                    <h1 class="lino-form-title">
                        <i class="bi bi-plus-circle me-3"></i>Crear Nuevo Producto
                    </h1>
                    <p class="lino-form-subtitle">
                        Complete la informaci√≥n del producto diet√©tico para agregarlo al inventario
                    </p>
                </div>

                <form method="post" enctype="multipart/form-data" id="productoForm">
                    {% csrf_token %}
                    
                    <!-- INFORMACI√ìN B√ÅSICA -->
                    <div class="lino-form-grid lino-form-grid--2col">
                        <div class="lino-form-group">
                            <label class="lino-form-label">
                                üìù Nombre del Producto
                                <span class="lino-form-label-required">*</span>
                            </label>
                            <input type="text" 
                                   name="nombre" 
                                   class="lino-form-input" 
                                   placeholder="Ej: Avena sin gluten 500g"
                                   required
                                   id="id_nombre">
                        </div>

                        <div class="lino-form-group">
                            <label class="lino-form-label">
                                üè∑Ô∏è Categor√≠a
                                <span class="lino-form-label-required">*</span>
                            </label>
                            <select name="categoria" class="lino-form-input lino-form-select" required id="id_categoria">
                                <option value="">Seleccionar categor√≠a...</option>
                                <option value="cereales">üåæ Cereales y Granos</option>
                                <option value="proteinas">ü•© Prote√≠nas</option>
                                <option value="lacteos">ü•õ L√°cteos sin Lactosa</option>
                                <option value="frutas">üçé Frutas y Vegetales</option>
                                <option value="snacks">ü•ú Snacks Saludables</option>
                                <option value="bebidas">üßÉ Bebidas Funcionales</option>
                                <option value="suplementos">üíä Suplementos</option>
                                <option value="otros">üì¶ Otros</option>
                            </select>
                        </div>

                        <div class="lino-form-group">
                            <label class="lino-form-label">
                                üí∞ Precio
                                <span class="lino-form-label-required">*</span>
                            </label>
                            <div class="lino-input-group">
                                <span class="lino-input-group-text">$</span>
                                <input type="number" 
                                       name="precio" 
                                       class="lino-form-input" 
                                       placeholder="0.00"
                                       step="0.01"
                                       min="0"
                                       required
                                       id="id_precio">
                            </div>
                        </div>

                        <div class="lino-form-group">
                            <label class="lino-form-label">
                                üì¶ Stock Inicial
                                <span class="lino-form-label-required">*</span>
                            </label>
                            <input type="number" 
                                   name="stock" 
                                   class="lino-form-input" 
                                   placeholder="0"
                                   min="0"
                                   required
                                   id="id_stock">
                        </div>
                    </div>

                    <!-- INFORMACI√ìN NUTRICIONAL -->
                    <div class="lino-form-group" style="margin-top: 32px;">
                        <label class="lino-form-label">
                            üìä Informaci√≥n Nutricional (por 100g)
                        </label>
                        <div class="lino-form-grid lino-form-grid--3col" style="margin-top: 16px;">
                            <div class="lino-form-group">
                                <label class="lino-form-label">‚ö° Calor√≠as</label>
                                <div class="lino-input-group">
                                    <input type="number" 
                                           name="calorias" 
                                           class="lino-form-input" 
                                           placeholder="0"
                                           min="0"
                                           id="id_calorias">
                                    <span class="lino-input-group-text">kcal</span>
                                </div>
                            </div>

                            <div class="lino-form-group">
                                <label class="lino-form-label">ü•© Prote√≠nas</label>
                                <div class="lino-input-group">
                                    <input type="number" 
                                           name="proteinas" 
                                           class="lino-form-input" 
                                           placeholder="0.0"
                                           step="0.1"
                                           min="0"
                                           id="id_proteinas">
                                    <span class="lino-input-group-text">g</span>
                                </div>
                            </div>

                            <div class="lino-form-group">
                                <label class="lino-form-label">üåæ Carbohidratos</label>
                                <div class="lino-input-group">
                                    <input type="number" 
                                           name="carbohidratos" 
                                           class="lino-form-input" 
                                           placeholder="0.0"
                                           step="0.1"
                                           min="0"
                                           id="id_carbohidratos">
                                    <span class="lino-input-group-text">g</span>
                                </div>
                            </div>

                            <div class="lino-form-group">
                                <label class="lino-form-label">ü•ë Grasas</label>
                                <div class="lino-input-group">
                                    <input type="number" 
                                           name="grasas" 
                                           class="lino-form-input" 
                                           placeholder="0.0"
                                           step="0.1"
                                           min="0"
                                           id="id_grasas">
                                    <span class="lino-input-group-text">g</span>
                                </div>
                            </div>

                            <div class="lino-form-group">
                                <label class="lino-form-label">üåø Fibra</label>
                                <div class="lino-input-group">
                                    <input type="number" 
                                           name="fibra" 
                                           class="lino-form-input" 
                                           placeholder="0.0"
                                           step="0.1"
                                           min="0"
                                           id="id_fibra">
                                    <span class="lino-input-group-text">g</span>
                                </div>
                            </div>

                            <div class="lino-form-group">
                                <label class="lino-form-label">üßÇ Sodio</label>
                                <div class="lino-input-group">
                                    <input type="number" 
                                           name="sodio" 
                                           class="lino-form-input" 
                                           placeholder="0"
                                           min="0"
                                           id="id_sodio">
                                    <span class="lino-input-group-text">mg</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DESCRIPCI√ìN -->
                    <div class="lino-form-group" style="margin-top: 32px;">
                        <label class="lino-form-label">
                            üìù Descripci√≥n
                        </label>
                        <textarea name="descripcion" 
                                  class="lino-form-input lino-form-textarea" 
                                  placeholder="Describe las caracter√≠sticas, beneficios y usos del producto..."
                                  id="id_descripcion"></textarea>
                    </div>

                    <!-- CARACTER√çSTICAS ESPECIALES -->
                    <div class="lino-form-group" style="margin-top: 32px;">
                        <label class="lino-form-label">
                            ‚≠ê Caracter√≠sticas Especiales
                        </label>
                        <div class="lino-form-grid lino-form-grid--2col" style="margin-top: 16px;">
                            <div class="lino-checkbox-group">
                                <input type="checkbox" name="sin_gluten" id="id_sin_gluten" class="lino-checkbox">
                                <label for="id_sin_gluten" class="lino-checkbox-label">üåæ Sin Gluten</label>
                            </div>
                            <div class="lino-checkbox-group">
                                <input type="checkbox" name="sin_lactosa" id="id_sin_lactosa" class="lino-checkbox">
                                <label for="id_sin_lactosa" class="lino-checkbox-label">ü•õ Sin Lactosa</label>
                            </div>
                            <div class="lino-checkbox-group">
                                <input type="checkbox" name="vegano" id="id_vegano" class="lino-checkbox">
                                <label for="id_vegano" class="lino-checkbox-label">üå± Vegano</label>
                            </div>
                            <div class="lino-checkbox-group">
                                <input type="checkbox" name="organico" id="id_organico" class="lino-checkbox">
                                <label for="id_organico" class="lino-checkbox-label">üçÉ Org√°nico</label>
                            </div>
                            <div class="lino-checkbox-group">
                                <input type="checkbox" name="keto" id="id_keto" class="lino-checkbox">
                                <label for="id_keto" class="lino-checkbox-label">ü•ë Keto Friendly</label>
                            </div>
                            <div class="lino-checkbox-group">
                                <input type="checkbox" name="bajo_sodio" id="id_bajo_sodio" class="lino-checkbox">
                                <label for="id_bajo_sodio" class="lino-checkbox-label">üßÇ Bajo en Sodio</label>
                            </div>
                        </div>
                    </div>

                    <!-- ACCIONES -->
                    <div class="lino-form-actions">
                        <a href="{% url 'gestion:lista_productos' %}" class="lino-action-button-compact lino-action-button-compact--secondary">
                            <div class="lino-action-button-compact__icon">
                                <i class="bi bi-arrow-left"></i>
                            </div>
                            <div class="lino-action-button-compact__content">
                                <div class="lino-action-button-compact__title">Cancelar</div>
                                <div class="lino-action-button-compact__subtitle">Volver al inventario</div>
                            </div>
                        </a>
                        <button type="submit" class="lino-action-button-compact lino-action-button-compact--success" id="btnGuardar">
                            <div class="lino-action-button-compact__icon">
                                <i class="bi bi-check-circle"></i>
                            </div>
                            <div class="lino-action-button-compact__content">
                                <div class="lino-action-button-compact__title">Crear Producto</div>
                                <div class="lino-action-button-compact__subtitle">Agregar al inventario</div>
                            </div>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- PREVIEW EN VIVO -->
        <div class="col-lg-4">
            <div class="preview-container">
                <div class="preview-card" id="previewCard">
                    <h5 style="color: var(--lino-primary); margin-bottom: 16px; font-weight: 700;">
                        üëÅÔ∏è Vista Previa
                    </h5>
                    
                    <div id="preview-content">
                        <div style="text-align: center; color: var(--lino-gray-500); padding: 32px 16px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                            <p style="margin: 0;">Completa el formulario para ver la vista previa del producto</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// ===== VARIABLES GLOBALES =====
let currentStep = 1;

// ===== NAVEGACI√ìN ENTRE PASOS =====
function nextStep(step) {
    console.log('Navegando al paso:', step);
    
    // Validar antes de avanzar
    if (!validateCurrentStep()) {
        return;
    }
    
    // Ocultar todos los pasos
    document.querySelectorAll('.lino-wizard-step-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Mostrar el paso objetivo
    const targetContent = document.querySelector(`.lino-wizard-step-content[data-step="${step}"]`);
    if (targetContent) {
        targetContent.classList.add('active');
    }
    
    // Actualizar indicadores visuales
    updateProgressIndicators(step);
    
    // Si es paso 3, actualizar resumen
    if (step === 3) {
        updateSummary();
    }
    
    currentStep = step;
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function prevStep(step) {
    nextStep(step);
}

// ===== ACTUALIZAR INDICADORES =====
function updateProgressIndicators(step) {
    document.querySelectorAll('.lino-wizard-step').forEach((stepEl, index) => {
        const stepNumber = index + 1;
        const circle = stepEl.querySelector('.lino-wizard-step-circle');
        
        stepEl.classList.remove('lino-wizard-step--active', 'lino-wizard-step--completed');
        
        if (stepNumber === step) {
            stepEl.classList.add('lino-wizard-step--active');
            circle.textContent = stepNumber;
        } else if (stepNumber < step) {
            stepEl.classList.add('lino-wizard-step--completed');
            circle.innerHTML = '<i class="bi bi-check"></i>';
        } else {
            circle.textContent = stepNumber;
        }
    });
}

// ===== VALIDACIONES =====
function validateCurrentStep() {
    if (currentStep === 1) {
        const nombre = document.getElementById('nombreInput').value.trim();
        const categoria = document.getElementById('categoriaInput').value;
        const precio = document.getElementById('precioInput').value;
        const stock = document.getElementById('stockInput').value;
        
        if (!nombre) {
            showWarning('Campo requerido', 'Por favor ingrese el nombre del producto');
            document.getElementById('nombreInput').focus();
            return false;
        }
        
        if (!categoria) {
            showWarning('Campo requerido', 'Por favor seleccione una categor√≠a');
            document.getElementById('categoriaInput').focus();
            return false;
        }
        
        if (!precio || parseFloat(precio) <= 0) {
            showWarning('Precio inv√°lido', 'El precio debe ser mayor a 0');
            document.getElementById('precioInput').focus();
            return false;
        }
        
        if (stock === '' || parseInt(stock) < 0) {
            showWarning('Stock inv√°lido', 'El stock debe ser 0 o mayor');
            document.getElementById('stockInput').focus();
            return false;
        }
    }
    
    return true;
}

// ===== RESUMEN =====
function updateSummary() {
    // Datos b√°sicos
    const nombre = document.getElementById('nombreInput').value || '-';
    const categoria = document.getElementById('categoriaInput').selectedOptions[0]?.text || '-';
    const precio = document.getElementById('precioInput').value || '0';
    const stock = document.getElementById('stockInput').value || '0';
    
    document.getElementById('summaryNombre').textContent = nombre;
    document.getElementById('summaryCategoria').textContent = categoria;
    document.getElementById('summaryStock').textContent = stock;
    document.getElementById('summaryPrecio').textContent = `$${parseFloat(precio).toFixed(2)}`;
    
    // Info nutricional
    const calorias = document.getElementById('caloriasInput').value;
    const proteinas = document.getElementById('proteinasInput').value;
    const carbos = document.getElementById('carbosInput').value;
    
    const tieneInfoNutricional = calorias || proteinas || carbos;
    const infoCard = document.getElementById('infoNutricionalCard');
    
    if (tieneInfoNutricional) {
        infoCard.style.display = 'block';
        document.getElementById('summaryCalorias').textContent = calorias ? `${calorias} kcal` : '-';
        document.getElementById('summaryProteinas').textContent = proteinas ? `${proteinas}g` : '-';
        document.getElementById('summaryCarbs').textContent = carbos ? `${carbos}g` : '-';
    } else {
        infoCard.style.display = 'none';
    }
}

// ===== NOTIFICACIONES =====
function showWarning(title, message) {
    // Usar el sistema de notificaciones de LINO si existe
    if (typeof window.showWarning === 'function') {
        window.showWarning(title, message);
    } else {
        alert(`${title}\n${message}`);
    }
}

// ===== INICIALIZACI√ìN =====
document.addEventListener('DOMContentLoaded', function() {
    console.log('üåø LINO Wizard Productos - Inicializado');
    
    // Configurar validaci√≥n de env√≠o
    const form = document.getElementById('productoForm');
    form.addEventListener('submit', function(e) {
        if (currentStep !== 3) {
            e.preventDefault();
            showWarning('Paso incompleto', 'Debe completar todos los pasos antes de crear el producto');
            return false;
        }
        
        // Cambiar texto del bot√≥n
        const btnSubmit = document.getElementById('btnSubmit');
        btnSubmit.innerHTML = '<div class="lino-loading-spinner"></div> Creando...';
        btnSubmit.disabled = true;
        
        console.log('‚úÖ Formulario enviado');
    });
});
</script>
{% endblock %}
