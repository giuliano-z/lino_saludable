{% extends 'gestion/base.html' %}
{% load dietetica_tags %}

{% block title %}Dashboard | LINO SYS{% endblock %}
{% block header %}Dashboard{% endblock %}

{% block content %}

<!-- Banner de Alertas Cr√≠ticas -->
{% if productos_sin_stock > 0 or materias_stock_critico > 0 %}
<div class="lino-alert lino-alert--warning">
    <div class="lino-alert__content">
        <i class="bi bi-exclamation-triangle-fill lino-alert__icon"></i>
        <div class="lino-alert__text">
            <strong>¬°Atenci√≥n!</strong> 
            {% if productos_sin_stock > 0 %}{{ productos_sin_stock }} producto(s) sin stock{% endif %}
            {% if productos_sin_stock > 0 and materias_stock_critico > 0 %} y {% endif %}
            {% if materias_stock_critico > 0 %}{{ materias_stock_critico }} materia(s) prima(s) en stock cr√≠tico{% endif %}
        </div>
    </div>
</div>
{% endif %}

<!-- KPIs Principales usando LINO V3 -->
<div class="lino-kpi-grid">
    <div class="lino-kpi-card">
        <div class="lino-kpi-card__header">
            <h3 class="lino-kpi-card__title">Ingresos del Mes</h3>
            <div class="lino-kpi-card__icon lino-kpi-card__icon--success">
                <i class="bi bi-cash-stack"></i>
            </div>
        </div>
        <div class="lino-kpi-card__content">
            <div class="lino-kpi-card__value">${{ ingresos_mes|floatformat:0|default:"0" }}</div>
            <div class="lino-kpi-card__change lino-kpi-card__change--positive">
                <i class="bi bi-arrow-up"></i>
                <span>+100% vs mes anterior</span>
            </div>
        </div>
    </div>
    
    <div class="lino-kpi-card">
        <div class="lino-kpi-card__header">
            <h3 class="lino-kpi-card__title">Productos en Stock</h3>
            <div class="lino-kpi-card__icon lino-kpi-card__icon--info">
                <i class="bi bi-boxes"></i>
            </div>
        </div>
        <div class="lino-kpi-card__content">
            <div class="lino-kpi-card__value">{{ total_productos|default:"69" }}</div>
            <div class="lino-kpi-card__subtitle">
                {% if productos_stock_bajo_count > 0 %}
                    <span style="color: var(--lino-warning);">{{ productos_stock_bajo_count }} por agotarse</span>
                {% else %}
                    <span style="color: var(--lino-success);">1 por agotarse</span>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="lino-kpi-card">
        <div class="lino-kpi-card__header">
            <h3 class="lino-kpi-card__title">Productos Cr√≠ticos</h3>
            <div class="lino-kpi-card__icon lino-kpi-card__icon--error">
                <i class="bi bi-exclamation-triangle-fill"></i>
            </div>
        </div>
        <div class="lino-kpi-card__content">
            <div class="lino-kpi-card__value">{{ materias_stock_critico|default:"1" }}</div>
            <div class="lino-kpi-card__change lino-kpi-card__change--negative">
                <i class="bi bi-arrow-down"></i>
                <span>Requieren reposici√≥n</span>
            </div>
        </div>
    </div>
    
    <div class="lino-kpi-card">
        <div class="lino-kpi-card__header">
            <h3 class="lino-kpi-card__title">Margen de Rentabilidad</h3>
            <div class="lino-kpi-card__icon lino-kpi-card__icon--info">
                <i class="bi bi-percent"></i>
            </div>
        </div>
        <div class="lino-kpi-card__content">
            <div class="lino-kpi-card__value">0%</div>
            <div class="lino-kpi-card__subtitle">Margen bruto estimado</div>
        </div>
    </div>
</div>

<!-- Secci√≥n adicional -->
<div class="lino-card" style="margin-top: var(--lino-space-8);">
    <div class="lino-card__header">
        <h2 class="lino-card__title">An√°lisis y Gr√°ficos</h2>
    </div>
    <div class="lino-card__content">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--lino-space-6);">
            <div>
                <h3 style="color: var(--lino-gray-700); margin-bottom: var(--lino-space-4);">Ventas de los √öltimos 7 D√≠as</h3>
                <p style="color: var(--lino-gray-600);">Seguimiento de rendimiento diario</p>
                <div style="height: 200px; background: var(--lino-gray-100); border-radius: var(--lino-radius); display: flex; align-items: center; justify-content: center; color: var(--lino-gray-500);">
                    üìä Gr√°fico en desarrollo
                </div>
            </div>
            <div>
                <h3 style="color: var(--lino-gray-700); margin-bottom: var(--lino-space-4);">Transacciones Recientes</h3>
                <div style="space-y: var(--lino-space-3);">
                    <div style="display: flex; align-items: center; gap: var(--lino-space-3); padding: var(--lino-space-3); background: white; border-radius: var(--lino-radius); border: 1px solid var(--lino-gray-200);">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--lino-success); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">V</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--lino-gray-900);">Venta #2</div>
                            <div style="font-size: var(--lino-font-size-sm); color: var(--lino-gray-500);">2 months ago ‚Ä¢ Javier Milei</div>
                        </div>
                        <div style="font-weight: 600; color: var(--lino-success);">+$10.001</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--lino-space-3); padding: var(--lino-space-3); background: white; border-radius: var(--lino-radius); border: 1px solid var(--lino-gray-200);">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--lino-success); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">V</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--lino-gray-900);">Venta #1</div>
                            <div style="font-size: var(--lino-font-size-sm); color: var(--lino-gray-500);">2 months ago ‚Ä¢ Milei Javier</div>
                        </div>
                        <div style="font-weight: 600; color: var(--lino-success);">+$10.800</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
